# Natas25

*	user: `natas25`
*	pass: `GHF6X7YwACaYYssHVY05cFq83hRktl4c`
*	url: [http://natas25.natas.labs.overthewire.org](http://natas25:GHF6X7YwACaYYssHVY05cFq83hRktl4c@natas25.natas.labs.overthewire.org)
*	flag: `oGgWAJ7zcGT28vYazGo4rkhOPDhBu34T`

## Procedure

1.	At first look, seems that `lang` parameter could be the vehicle of
	the attack. According to the source code, some checks are performed
	on it...

2.	Firstly, we're not allowed to include `natas_webpass` string, so
	direct access to `/etc/natas_webpass/natas26` file is not feasible.

3.	Secondly, a check against the presence of `../` is performed. In
	this case, all the occurrences of `../` in `$filename` are removed.

4.	BINGO! The string "`..././`" will be converted in "`../`", so we are
	now allowed to fully visit the file system, and then, also the log
	file generated by `logRequest()`.

5.	Since `/etc/natas_webpass/natas26` is not directly accessible, we
	can try to access it via the log file. Fortunately, `logRequest()`
	function does not perform any check on the variable
	`$_SERVER['HTTP_USER_AGENT']`, so we can use it to inject the
	PHP code

		<?php echo file_get_contents("/etc/natas_webpass/natas26"); ?>

6.	Well. The attack is defined. A Python script
	([natas25.py](./scripts/natas25.py)) will do it on behalf us.

		$ python scripts/natas25.py
		<html>
		<head>
		<!-- This stuff in the header has nothing to do with the level -->

		[cut]

		[01.05.2015 10::59:23] oGgWAJ7zcGT28vYazGo4rkhOPDhBu34T
		 "Illegal file access detected! Aborting!"
		[01.05.2015 10::59:23] oGgWAJ7zcGT28vYazGo4rkhOPDhBu34T
		 "Directory traversal attempt! fixing request."

		[cut]

		</body>
		</html>




